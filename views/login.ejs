<%- include('partials/header', { user: typeof user !== 'undefined' ? user : undefined }) %>

<div class="row justify-content-center">
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <h2 class="text-center mb-4">Login to Your Account</h2>
        <form action="<%= typeof action !== 'undefined' ? action : '/login' %>" method="POST">
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" name="password" required>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-primary">Login</button>
          </div>
        </form>
        <div class="text-center mt-3">
          <p>Don't have an account? <a href="/signup">Sign Up</a></p>
        </div>
      </div>
    </div>
  </div>
</div>

  <script>
    // Login Form Validation (improved)
    (function () {
      'use strict';

      const form = document.getElementById('loginForm') || document.querySelector('form[action="/login"]');
      if (!form) return;

      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      function setValidity(el, valid) {
        if (!el) return;
        el.classList.toggle('is-invalid', !valid);
        el.classList.toggle('is-valid', valid);
      }

      if (emailInput) {
        emailInput.addEventListener('blur', () => {
          setValidity(emailInput, emailPattern.test(emailInput.value || ''));
        });
      }

      if (passwordInput) {
        passwordInput.addEventListener('input', () => {
          setValidity(passwordInput, (passwordInput.value || '').length >= 6);
        });
      }

      form.addEventListener('submit', function (event) {
        let ok = true;
        if (emailInput && !emailPattern.test(emailInput.value || '')) ok = false;
        if (passwordInput && (passwordInput.value || '').length < 6) ok = false;

        if (!ok) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    })();
  </script>

<%- include('partials/footer') %>
