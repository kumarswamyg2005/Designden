<%- include('partials/header', { user: typeof user !=='undefined' ? user : undefined }) %>

  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <h2 class="text-center mb-4">Create an Account</h2>
          <form action="/signup" method="POST">
            <div class="mb-3">
              <label for="username" class="form-label">Username</label>
              <input type="text" class="form-control" id="username" name="username"
                value="<%= typeof formData !== 'undefined' ? formData.username : '' %>" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email"
                value="<%= typeof formData !== 'undefined' ? formData.email : '' %>" required>
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <div class="mb-3">
              <label for="contactNumber" class="form-label">Contact Number</label>
              <input type="tel" class="form-control" id="contactNumber" name="contactNumber"
                value="<%= typeof formData !== 'undefined' ? formData.contactNumber : '' %>" required>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">Sign Up</button>
            </div>
          </form>
          <div class="text-center mt-3">
            <p>Already have an account? <a href="/login">Login</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Signup Form Validation (improved, lightweight)
    (function () {
      'use strict';

      const form = document.getElementById('signupForm');
      if (!form) return;

      const usernameInput = document.getElementById('username');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      const contactInput = document.getElementById('contactNumber');

      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // simple, effective
      const phonePattern = /^\d{10}$/;

      function setValidity(el, valid) {
        if (!el) return;
        el.classList.toggle('is-invalid', !valid);
        el.classList.toggle('is-valid', valid);
      }

      if (usernameInput) {
        usernameInput.addEventListener('blur', () => {
          const v = (usernameInput.value || '').trim();
          setValidity(usernameInput, v.length >= 3 && v.length <= 50);
        });
      }

      if (emailInput) {
        emailInput.addEventListener('blur', () => {
          setValidity(emailInput, emailPattern.test(emailInput.value || ''));
        });
      }

      if (passwordInput) {
        passwordInput.addEventListener('input', () => {
          setValidity(passwordInput, (passwordInput.value || '').length >= 6);
        });
      }

      if (contactInput) {
        contactInput.addEventListener('input', () => {
          // keep digits only
          contactInput.value = (contactInput.value || '').replace(/\D/g, '');
          setValidity(contactInput, phonePattern.test(contactInput.value));
        });
      }

      form.addEventListener('submit', function (e) {
        let ok = true;
        if (usernameInput && ((usernameInput.value || '').trim().length < 3 || (usernameInput.value || '').trim().length > 50)) ok = false;
        if (emailInput && !emailPattern.test(emailInput.value || '')) ok = false;
        if (passwordInput && (passwordInput.value || '').length < 6) ok = false;
        if (contactInput && !phonePattern.test(contactInput.value || '')) ok = false;

        if (!ok) {
          e.preventDefault();
          e.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    })();
  </script>

  <%- include('partials/footer') %>